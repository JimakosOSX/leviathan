#!/usr/bin/env bash

rm $1
####
exec 3>&1 4>&2
trap 'exec 2>&4 1>&3' 0 1 2 3
exec 1>$1 2>&1
####
# Everything below will go to the file given as argument

updated=$(TZ="{{ timezone }}" date)
echo "Last update: ${updated}"
echo
echo "--- Hostname ---"
hostname
echo
echo "--- IP ADDRESSES ---"
ip -f inet a | awk '/inet / { print $2 }'
echo
echo "--- RAM USAGE ---"
free -m
echo
echo "--- DISK USAGE ---"
df -h /
echo
echo "--- MAILBOX SIZE ---"
du -hs /var/mail/vhosts/{{ server_fqdn }}
echo
echo "--- Load Avg ---"
uptime
echo
echo "--- Kernel Info ---"
uname -a
echo
